"use strict";angular.module("adminApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/posts",{templateUrl:"views/posts.html",controller:"PostsCtrl"}).when("/posts",{templateUrl:"views/posts.html",controller:"PostsCtrl"}).when("/posts/new",{templateUrl:"views/post_editor.html",controller:"PostEditionCtrl"}).when("/posts/edit/:id",{templateUrl:"views/post_editor.html",controller:"PostEditionCtrl"}).when("/pages",{templateUrl:"views/pages.html",controller:"PagesCtrl"}).when("/pages/new",{templateUrl:"views/page_editor.html",controller:"PageEditionCtrl"}).when("/pages/edit/:id",{templateUrl:"views/page_editor.html",controller:"PageEditionCtrl"}).when("/seo",{templateUrl:"views/seo.html",controller:"SeoCtrl"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("adminApp").factory("Site",["$location","$rootScope",function(){return{siteId:""}}]).factory("user",["$location","$rootScope",function(a,b){return{logIn:function(a,c){return b.$broadcast("event:sessionUpdated"),Parse.User.logIn(a,c)},logOut:function(){Parse.User.logOut(),b.$broadcast("event:sessionUpdated"),this.isLogin=!1},current:function(){return Parse.User.current()},isAuthenticated:function(){return Parse.User.current()?(this.isLogin=!0,!0):(this.isLogin=!1,!1)},isLogin:!1}}]),angular.module("adminApp").controller("BBCoreCtrl",["$sce","$rootScope","$scope","$route","$routeParams","$location","user","Site",function(a,b,c,d,e,f,g){c.bbcore={},c.bbcore.user=g,c.bbcore.edit=!0,c.bbcore.selectedElement="",c.versions=[],c.bbcore.sortablePageMenuOptions={start:function(){c.bbcore.snapShot()},update:function(){c.bbcore.updateHistorial()},axis:"y"},c.bbcore.user.logIn("dev","default");var h=function(){var a=new Parse.Query("Site"),b=window.location.origin.replace(/http(s)?:\/\//g,"").split(".")[0];a.equalTo("url",b),a.find().then(function(a){var b=JSON.parse(a[0].get("schema"));return console.log("Schema"+JSON.parse(a[0].get("schema"))),c.bbcore.site=JSON.parse(a[0].get("schema")),c.bbcore.siteQuery=a,c.$apply(),b.siteId=a[0].id,c.bbcore.siteId=b.siteId,c.bbcore.site},function(a){alert(a)})};h(),c.bbcore.addPage=function(a,b,e){var f=c.bbcore.site.pages.length+1,g={id:f,title:a,description:a,type:"page",content:e,url:b};c.bbcore.site.pages.push(g);var h=new RegExp("^\\/"+b+"$"),i="/"+b,j="";return"/"===b?(j=b,h=new RegExp("^\\"+b+"$"),i=b):j="/"+b,d.routes[j]={keys:[],originalPath:i,regexp:h,reloadOnSearch:!0,templateUrl:"views/_page.html"},"/"!==b&&(h=new RegExp("^\\/"+b+"\\/$"),d.routes[j+"/"]={keys:[],originalPath:i+"/",regexp:h,reloadOnSearch:!0,redirectTo:j}),g},c.toggleEdition=function(){c.bbcore.edit=c.bbcore.edit===!0?!1:!0},c.trustedHtml=function(b){return a.trustAsHtml(b)}}]).controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]).controller("PostsCtrl",["$scope",function(){}]).controller("PagesCtrl",["$scope",function(){}]).controller("PostEditionCtrl",["$rootScope","$scope","$route","$routeParams","Site",function(a,b,c,d){b.getContent=function(){return"Retrieved Content"};var e=function(){var c=new Parse.Query("Site"),e=window.location.origin.replace(/http(s)?:\/\//g,"").split(".")[0];c.equalTo("url",e),c.find().then(function(c){var e=JSON.parse(c[0].get("schema"));console.log("Schema"+JSON.parse(c[0].get("schema"))),b.bbcore.site=JSON.parse(c[0].get("schema")),b.$apply(),e.siteId=c[0].id,b.bbcore.siteId=e.siteId,b.siteId=e.siteId;var f=(b.bbcore.siteId,d.id);console.log("Site.siteId: "+e.siteId),b.bbcore.currentPost=b.bbcore.site.posts.filter(function(a){return a.postId==f?a:void 0}),b.bbcore.currentPost=b.bbcore.currentPost[0],b.$apply(),b.bbcore.currentPost?a.$broadcast("loadedContent",b.bbcore.currentPost.content):a.$broadcast("loadedContent")},function(a){alert(a.message)})};e()}]).controller("PageEditionCtrl",["$rootScope","$scope","$route","$routeParams","Site",function(a,b,c,d){b.getContent=function(){return"Retrieved Content"};var e=function(){var c=new Parse.Query("Site"),e=window.location.origin.replace(/http(s)?:\/\//g,"").split(".")[0];c.equalTo("url",e),c.find().then(function(c){var e=JSON.parse(c[0].get("schema"));console.log("Schema"+JSON.parse(c[0].get("schema"))),b.bbcore.site=JSON.parse(c[0].get("schema")),b.$apply(),e.siteId=c[0].id,b.bbcore.siteId=e.siteId,b.siteId=e.siteId;var f=(b.bbcore.siteId,d.id);console.log("Site.siteId: "+e.siteId),b.bbcore.currentPage=b.bbcore.site.pages.filter(function(a){return a.pageId==f?a:void 0}),b.bbcore.currentPage=b.bbcore.currentPage[0],b.$apply(),b.bbcore.currentPage?a.$broadcast("loadedContent",b.bbcore.currentPage.content):a.$broadcast("loadedContent")},function(a){alert(a.message)})};e()}]).controller("SeoCtrl",["$scope",function(){}]).controller("SettingCtrl",["$scope",function(){}]),angular.module("adminApp").directive("bbPostsManager",function(){return{restrict:"A",scope:!1,link:function(a,b){b.on("click",".select-all",function(){$(this).prop("checked")?b.find('.post-list input[type="checkbox"]').prop("checked",!0):b.find('.post-list input[type="checkbox"]').prop("checked",!1)}),b.on("click","button.bulk-operation",function(){var c=b.find("#bulk").eq(0).val();""!==c?(b.find('.post-list input[type="checkbox"]:checked').each(function(){var b=$(this).data("post-id");"delete"===c&&(a.bbcore.site.posts=a.bbcore.site.posts.filter(function(a){return a.postId!==b?a:void 0}))}),a.$apply(),a.bbcore.siteQuery[0].set("schema",JSON.stringify(a.bbcore.site)),a.bbcore.siteQuery[0].save().then(function(){$location.path("/posts"),a.$apply()},function(a){alert(a.message)})):alert("Select an Action")})},templateUrl:"scripts/directives/posts_manager.html",replace:!0,transclude:!1}}).directive("bbPostEditor",["$location",function(a){return{restrict:"A",scope:!1,link:function(b,c){var d="editor1",e=function(){CKEDITOR.replace("editor1",{allowedContent:!0})};e();var f=CKEDITOR.instances[d];b.$on("loadedContent",function(){b.bbcore.currentPost||(b.bbcore.currentPost={postId:8,content:""},b.bbcore.site.posts.push(b.bbcore.currentPost)),b.$apply(),f.setData(b.bbcore.currentPost.content)}),c.on("click",'button[data-action="save-post"]',function(){!function(){var a,c=new Date,d=b.bbcore.currentPost.postId;b.bbcore.site.posts.filter(function(b,c){return b.postId===d?(a=c,b):void 0});var e=f.getData();b.bbcore.currentPost.content=e,b.bbcore.currentPost.url=b.bbcore.currentPost.title.toLowerCase().split(" ").join("-"),b.bbcore.site.posts[a].content=e,b.bbcore.site.posts[a].updatedAt=c.toGMTString(),b.$apply()}(),b.bbcore.siteQuery[0].set("schema",JSON.stringify(b.bbcore.site)),b.bbcore.siteQuery[0].save().then(function(){a.path("/posts"),b.$apply()},function(a){alert(a.message)})}),c.on("click",'button[data-action="dismiss"]',function(){a.path("/posts"),b.$apply()})},templateUrl:"scripts/directives/post_editor.html",replace:!0,transclude:!1}}]).directive("bbPagesManager",function(){return{restrict:"A",scope:!1,link:function(a,b){b.on("click",".select-all",function(){$(this).prop("checked")?b.find('.page-list input[type="checkbox"]').prop("checked",!0):b.find('.page-list input[type="checkbox"]').prop("checked",!1)}),b.on("click","button.bulk-operation",function(){var c=b.find("#bulk").eq(0).val();""!==c?(b.find('.page-list input[type="checkbox"]:checked').each(function(){var b=$(this).data("page-id");"delete"===c&&(a.bbcore.site.pages=a.bbcore.site.pages.filter(function(a){return a.pageId!==b?a:void 0}))}),a.$apply(),a.bbcore.siteQuery[0].set("schema",JSON.stringify(a.bbcore.site)),a.bbcore.siteQuery[0].save().then(function(){$location.path("/pages"),a.$apply()},function(a){alert(a.message)})):alert("Select an Action")})},templateUrl:"scripts/directives/pages_manager.html",replace:!0,transclude:!1}}).directive("bbPageEditor",["$location",function(a){return{restrict:"A",scope:!1,link:function(b,c){var d="editor1",e=function(){CKEDITOR.replace("editor1",{allowedContent:!0})};e();var f=CKEDITOR.instances[d];b.$on("loadedContent",function(){b.bbcore.currentPage||(b.bbcore.currentPage={pageId:8,content:""},b.bbcore.site.pages.push(b.bbcore.currentPage)),b.$apply(),f.setData(b.bbcore.currentPage.content)}),c.on("click",'button[data-action="save"]',function(){!function(){var a,c=new Date,d=b.bbcore.currentPage.pageId;b.bbcore.site.pages.filter(function(b,c){return b.pageId===d?(a=c,b):void 0});var e=f.getData();b.bbcore.currentPage.content=e,b.bbcore.currentPage.url=b.bbcore.currentPage.title.toLowerCase().split(" ").join("-"),b.bbcore.site.pages[a].content=e,b.bbcore.site.pages[a].updatedAt=c.toGMTString(),b.$apply()}(),b.bbcore.site.posts=[{postId:0,title:"Useful Tips",content:"<p>We have selected this very useful teps for you!</p>"},{postId:1,title:"How to be a succesful Chef",content:"<p>We have selected this very useful for chefs!</p>"}],b.$apply(),b.bbcore.siteQuery[0].set("schema",JSON.stringify(b.bbcore.site)),b.bbcore.siteQuery[0].save().then(function(){a.path("/pages"),b.$apply()},function(a){alert(a.message)})}),c.on("click",'button[data-action="dismiss"]',function(){a.path("/pages"),b.$apply()})},templateUrl:"scripts/directives/page_editor.html",replace:!0,transclude:!1}}]);